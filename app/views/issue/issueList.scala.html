@(title: String, currentPage: Page[Issue], param:support.SearchCondition, project:Project)

@import helper._
@implicitFieldConstructor = @{ FieldConstructor(twitterBootstrapInput.render) } 

@header(label:String, sortBy:String) = {
    <th>
        <a class="th-sort" href="@routes.IssueApp.issues(project.owner, project.name, param.state)" data-sort-by="@sortBy">@label</a>
        @if(sortBy == param.sortBy){
        @if(param.orderBy == "desc"){
        <i class="icon-chevron-down"></i>
        } else {
        <i class="icon-chevron-up"></i>
        }
        }
    </th>

}

@main(Messages(title), project){
<style>
@@IMPORT url("/assets/stylesheets/issue.css");
</style>
<div class="page-padding">
  <ul class="breadcrumb page-navi pull-right">
      <li><a href="#" class="icon-home"></a><span class="divider">&gt;</span></li>
      <li><a href="#">project home</a><span class="divider">&gt;</span></li>
      <li class="active">Issue</li>
  </ul>

  <ul class="breadcrumb project-name">
      <li><a href="#">@project.owner</a><span class="divider">/</span></li>
      <li class="active"><a href="#">@project.name</a></li>
  </ul>

  <div class="dashboard">
    <dl class="row-fluid">
      <div class="span4"><dt><b>All</b> issues</dt><dd class="all inner-shadow pull-right" title="312,549">@Issue.countIssues(project.id, State.ALL)</dd></div>
      <div class="span4"><dt><b>Open</b> issues</dt><dd class="open inner-shadow pull-right" title="32,047">@Issue.countIssues(project.id, State.OPEN)</dd></div>
      <div class="span4"><dt><b>Closed</b> issues</dt><dd class="closed inner-shadow pull-right" title="4,086">@Issue.countIssues(project.id, State.CLOSED)</dd></div>
    </dl>

    <hr/>
    <form class="form-search" action="@routes.IssueApp.issues(project.owner, project.name, param.state)" method="GET">
      <button type="button" id="advanced-search" class="btn btn-small btn-flat" data-toggle="button">Advanced Search</button>
      <a href="@routes.IssueApp.extractExcelFile(project.owner, project.name, param.state)" class="btn btn-small btn-flat">Download Excel file</a>
      <div class="input-append pull-right">
        <input type="hidden" name="orderBy" value="@param.orderBy" class="h-value order">
        <input type="hidden" name="state" value="@param.state">
        <input name="filter" class="span2" id="appendedInputButton" size="16" type="text"><button class="btn" type="button"  placeholder="현재 게시글에서 검색">SEARCH</button>
      </div>
    </form>

    <form class="form-horizontal" id="labels-form">
      <!-- issue.label module make this as label filter and editor -->
      <fieldset class="labels"></fieldset>
    </form>

  </div>

  <p class="ordering">
      <span>▲상태순</span>
      <span>▲날짜순</span>
      <span selected>▼댓글순</span>
  </p>

  <table>
    <tbody>

      @for(issue <- currentPage.getList.reverse){
        <tr>
          <td class="no">@issue.id</td>
          <td class="attachmend attached">@if(Attachment.findByContainer(Resource.ISSUE_POST, issue.id).size > 0){<span class="icon-file"/>}</td>
          <td class="info">
            <p><a href="@routes.IssueApp.issue(project.owner, project.name, issue.id)">@issue.title</a></p>
            <p class="author">by <a href="/users/@issue.authorId">@issue.authorName</a>
            </a> @agoString(issue.ago())</p>
          </td>
          <td class="state @issue.state.toString.toLowerCase">@Messages(issue.state.state)</td>
          <td class="comments">@issue.numOfComments</td>
          <td class="assignee"><a href="#"><img class="user-picture" src="/assets/images/default-avatar-34.png"></a>
              <span>@{ if (issue.assigneeId == null) Messages("issue.noAssignee")
                else issue.assigneeName }</span>
          </td>

        </tr>
      }

    <tbody>
  </table>
  <div class="pull-right">
    <a class="btn btn-primary" href="@routes.IssueApp.newIssue(project.owner, project.name)" >@Messages("issue.menu.new")</a>
  </div>
  <div class="pagination pagination-centered">
    @pagination(currentPage, 5, "pagination")
  </div>
</div>

<script type="text/javascript">
  nforge.require('issue.label', '@routes.IssueLabelApp.getAll(project.owner, project.name)', '@routes.IssueLabelApp.post(project.owner, project.name)', {editable: true});
  nforge.require('issue.list');
</script>
}
